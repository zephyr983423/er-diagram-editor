<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âditeur de Diagrammes E-A (Merise)</title>
    <link rel="stylesheet" href="style.css">
    <!-- Konva.js via CDN pour la gestion du canvas et interactions -->
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1>√âditeur E-A (Merise)</h1>
        </div>
        <div class="header-center">
            <button id="btn-undo" class="btn btn-secondary" title="Annuler (Ctrl+Z)">
                <span class="icon">‚Ü∂</span> Annuler
            </button>
            <button id="btn-redo" class="btn btn-secondary" title="R√©tablir (Ctrl+Y)">
                <span class="icon">‚Ü∑</span> R√©tablir
            </button>
            <button id="btn-delete" class="btn btn-danger" title="Supprimer (Delete)">
                <span class="icon">üóë</span> Supprimer
            </button>
            <button id="btn-grid" class="btn btn-secondary active" title="Afficher/masquer la grille">
                <span class="icon">‚äû</span> Grille
            </button>
            <button id="btn-snap" class="btn btn-secondary" title="Activer/d√©sactiver le snap">
                <span class="icon">üß≤</span> Snap
            </button>
            <button id="btn-export" class="btn btn-primary" title="Exporter en JSON">
                <span class="icon">üíæ</span> Exporter
            </button>
            <button id="btn-import" class="btn btn-primary" title="Importer depuis JSON">
                <span class="icon">üìÅ</span> Importer
            </button>
            <button id="btn-clear" class="btn btn-danger" title="Effacer tout">
                <span class="icon">üóë</span> Effacer
            </button>
            <button id="btn-help" class="btn btn-secondary" title="Aide">
                <span class="icon">‚ùì</span> Aide
            </button>
        </div>
        <div class="header-right">
            <!-- Placeholder for future zoom controls -->
        </div>
    </header>

    <!-- Main container -->
    <div class="main-container">
        <!-- Left toolbar -->
        <aside class="toolbar">
            <h3>Outils</h3>
            <div class="tool-buttons">
                <button id="tool-select" class="tool-btn active" data-tool="select" title="Mode S√©lection (V)">
                    <span class="icon">‚Üñ</span>
                    <span class="label">S√©lection</span>
                </button>
                <button id="tool-entity" class="tool-btn" data-tool="entity" title="Ajouter Entit√© (E)">
                    <span class="icon">‚ñ≠</span>
                    <span class="label">Entit√©</span>
                </button>
                <button id="tool-association" class="tool-btn" data-tool="association" title="Ajouter Association (A)">
                    <span class="icon">‚¨≠</span>
                    <span class="label">Association</span>
                </button>
                <button id="tool-connection" class="tool-btn" data-tool="connection" title="Mode Connexion (C)">
                    <span class="icon">‚ü∑</span>
                    <span class="label">Connexion</span>
                </button>
            </div>
            <div class="toolbar-divider"></div>
            <div class="tool-info">
                <p id="tool-hint" class="hint-text">S√©lectionnez un outil</p>
            </div>
            <div class="toolbar-divider"></div>
            <div class="shortcuts">
                <h4>Raccourcis</h4>
                <ul>
                    <li><kbd>V</kbd> S√©lection</li>
                    <li><kbd>E</kbd> Entit√©</li>
                    <li><kbd>A</kbd> Association</li>
                    <li><kbd>C</kbd> Connexion</li>
                    <li><kbd>Del</kbd> Supprimer</li>
                    <li><kbd>Ctrl+Z</kbd> Annuler</li>
                    <li><kbd>Ctrl+Y</kbd> R√©tablir</li>
                    <li><kbd>Ctrl+C</kbd> Copier</li>
                    <li><kbd>Ctrl+V</kbd> Coller</li>
                </ul>
            </div>
        </aside>

        <!-- Canvas -->
        <main class="canvas-container">
            <div id="canvas-container" style="width: 100%; height: 100%;"></div>
        </main>
    </div>

    <!-- Entity Edit Modal -->
    <div id="entity-modal" class="modal-overlay">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>√âdition de l'entit√©</h2>
                <button id="entity-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <label class="modal-label">Nom de l'entit√©</label>
                    <input type="text" id="entity-modal-name" class="modal-input" placeholder="Nom de l'entit√©">
                </div>

                <div class="modal-section">
                    <label class="modal-label">Attributs</label>
                    <div id="entity-modal-attributes" class="attributes-container"></div>
                    <button id="entity-add-attribute" class="btn btn-add">+ Ajouter un attribut</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="entity-modal-cancel" class="btn btn-secondary">Annuler</button>
                <button id="entity-modal-confirm" class="btn btn-primary">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Association Edit Modal -->
    <div id="association-modal" class="modal-overlay">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>√âdition de l'association</h2>
                <button id="assoc-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <label class="modal-label">Nom de l'association</label>
                    <input type="text" id="assoc-modal-name" class="modal-input" placeholder="Nom de l'association">
                </div>

                <div class="modal-section">
                    <label class="modal-label">Connexions</label>
                    <div id="assoc-modal-connections" class="connections-container"></div>
                    <p class="help-text">Utilisez l'outil Connexion pour relier cette association √† des entit√©s.</p>
                </div>

                <div class="modal-section">
                    <label class="modal-label">Attributs de l'association</label>
                    <div id="assoc-modal-attributes" class="attributes-container"></div>
                    <button id="assoc-add-attribute" class="btn btn-add">+ Ajouter un attribut</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="assoc-modal-delete" class="btn btn-danger">Supprimer l'association</button>
                <button id="assoc-modal-cancel" class="btn btn-secondary">Annuler</button>
                <button id="assoc-modal-confirm" class="btn btn-primary">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Modal for import JSON -->
    <div id="import-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Importer un diagramme JSON</h2>
                <button id="import-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>S√©lectionnez un fichier JSON ou collez le contenu :</p>
                <input type="file" id="import-file" accept=".json" style="margin-bottom: 10px;">
                <textarea id="import-data" rows="15" placeholder='{"entities": [...], "associations": [...], "connections": [...]}'></textarea>
            </div>
            <div class="modal-footer">
                <button id="import-modal-cancel" class="btn btn-secondary">Annuler</button>
                <button id="import-confirm" class="btn btn-primary">Importer</button>
            </div>
        </div>
    </div>

    <!-- Modal for export JSON -->
    <div id="export-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Exporter le diagramme JSON</h2>
                <button id="export-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Copiez le JSON ci-dessous ou t√©l√©chargez le fichier :</p>
                <textarea id="export-data" rows="15" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button id="export-copy" class="btn btn-secondary">Copier</button>
                <button id="export-download" class="btn btn-primary">T√©l√©charger</button>
            </div>
        </div>
    </div>

    <!-- Modal for help -->
    <div id="help-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mode d'emploi - Mod√®le Entit√©-Association (Merise)</h2>
                <button id="help-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <section>
                        <h3>Principe du mod√®le Entit√©-Association</h3>
                        <p>Ce mod√®le suit la notation Merise/Chen o√π :</p>
                        <ul>
                            <li><strong>Entit√©s</strong> (rectangles) : repr√©sentent les objets m√©tier</li>
                            <li><strong>Associations</strong> (ellipses vertes) : repr√©sentent les liens entre entit√©s</li>
                            <li><strong>Connexions</strong> : relient les associations aux entit√©s avec des cardinalit√©s</li>
                        </ul>
                    </section>

                    <section>
                        <h3>Actions principales</h3>
                        <ul>
                            <li><strong>Cr√©er une entit√©:</strong> Cliquer sur "Entit√©" puis sur le canvas</li>
                            <li><strong>Cr√©er une association:</strong> Cliquer sur "Association" puis sur le canvas</li>
                            <li><strong>Cr√©er une connexion:</strong> Cliquer sur "Connexion", puis sur une association, puis sur une entit√©</li>
                            <li><strong>√âditer:</strong> Double-clic sur une entit√© ou association</li>
                            <li><strong>Supprimer:</strong> S√©lectionner puis appuyer sur Delete</li>
                        </ul>
                    </section>

                    <section>
                        <h3>√âdition des attributs</h3>
                        <p>Double-cliquez sur une entit√© ou association pour ouvrir la modale d'√©dition compl√®te :</p>
                        <ul>
                            <li>Ajouter, modifier, supprimer des attributs</li>
                            <li>D√©finir PK (cl√© primaire), UQ (unique), NULL, DEFAULT</li>
                            <li>Choisir le type SQL (INTEGER, VARCHAR, etc.)</li>
                            <li>Pour ENUM/SET : d√©finir les valeurs possibles</li>
                            <li>R√©ordonner les attributs avec les fl√®ches ‚Üë‚Üì</li>
                        </ul>
                        <p><strong>Important:</strong> Les modifications ne sont enregistr√©es que si vous cliquez sur "Confirmer"</p>
                    </section>

                    <section>
                        <h3>Navigation</h3>
                        <ul>
                            <li><strong>Pan (d√©placement):</strong> Cliquer-glisser sur une zone vide</li>
                            <li><strong>Zoom:</strong> Molette de souris (centr√© sur le curseur)</li>
                            <li><strong>Zoom boutons:</strong> Utiliser + / - dans le header</li>
                        </ul>
                    </section>

                    <section>
                        <h3>Raccourcis clavier</h3>
                        <table class="shortcuts-table">
                            <tr><td><kbd>V</kbd></td><td>Mode S√©lection</td></tr>
                            <tr><td><kbd>E</kbd></td><td>Mode Entit√©</td></tr>
                            <tr><td><kbd>A</kbd></td><td>Mode Association</td></tr>
                            <tr><td><kbd>C</kbd></td><td>Mode Connexion</td></tr>
                            <tr><td><kbd>Delete</kbd></td><td>Supprimer la s√©lection</td></tr>
                            <tr><td><kbd>Ctrl+Z</kbd></td><td>Annuler</td></tr>
                            <tr><td><kbd>Ctrl+Y</kbd> ou <kbd>Ctrl+Shift+Z</kbd></td><td>R√©tablir</td></tr>
                            <tr><td><kbd>Ctrl+C</kbd></td><td>Copier</td></tr>
                            <tr><td><kbd>Ctrl+V</kbd></td><td>Coller</td></tr>
                            <tr><td><kbd>Shift+Clic</kbd></td><td>S√©lection multiple</td></tr>
                            <tr><td><kbd>Clic droit</kbd></td><td>Menu contextuel</td></tr>
                            <tr><td><kbd>√âchap</kbd></td><td>Annuler action en cours</td></tr>
                        </table>
                    </section>

                    <section>
                        <h3>Cardinalit√©s</h3>
                        <p>Les cardinalit√©s disponibles sont :</p>
                        <ul>
                            <li><strong>0,1</strong> : Z√©ro ou un</li>
                            <li><strong>1,1</strong> : Exactement un</li>
                            <li><strong>0,n</strong> : Z√©ro ou plusieurs</li>
                            <li><strong>1,n</strong> : Un ou plusieurs</li>
                        </ul>
                    </section>

                    <section>
                        <h3>Associations n-aires</h3>
                        <p>Une association peut relier plus de 2 entit√©s. Cr√©ez simplement plusieurs connexions depuis la m√™me association vers diff√©rentes entit√©s.</p>
                    </section>

                    <section>
                        <h3>Sauvegarde</h3>
                        <ul>
                            <li>Le diagramme est <strong>automatiquement sauvegard√©</strong> dans le navigateur</li>
                            <li>Utilisez <strong>Exporter</strong> pour t√©l√©charger le JSON</li>
                            <li>Utilisez <strong>Importer</strong> pour charger un JSON</li>
                        </ul>
                    </section>
                </div>
            </div>
            <div class="modal-footer">
                <button id="help-modal-confirm" class="btn btn-primary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Context menu -->
    <div id="context-menu" class="context-menu" style="display: none;">
        <ul>
            <li id="ctx-edit">√âditer</li>
            <li id="ctx-copy">Copier</li>
            <li id="ctx-paste">Coller</li>
            <li id="ctx-delete">Supprimer</li>
        </ul>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
